<!DOCTYPE html>
<html>
<head>
  <title>è®¾ç½®åŒæ­¥åŠŸèƒ½æµ‹è¯•æŒ‡å—</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; background: #f0f2f5; }
    h1 { color: #1a365d; border-bottom: 3px solid #3182ce; padding-bottom: 10px; }
    h2 { color: #2c5282; margin-top: 30px; }
    .log { background: #f7fafc; padding: 15px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #3182ce; }
    .success { color: #22543d; }
    .error { color: #742a2a; }
    .warning { color: #744210; }
    .info { color: #2c5282; }
    code { background: #2d3748; color: #e2e8f0; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; }
    .code-block { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 8px; overflow-x: auto; margin: 10px 0; }
    .highlight { background: #fef5e7; padding: 15px; border-left: 4px solid #f59e0b; margin: 15px 0; border-radius: 4px; }
    .test-step { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>ğŸ¯ è®¾ç½®åŒæ­¥åŠŸèƒ½æµ‹è¯•æŒ‡å—</h1>

  <div class="highlight">
    <strong>âœ¨ ä¿®æ”¹è¯´æ˜ï¼š</strong>
    <ul>
      <li><strong>é—®é¢˜1ä¿®å¤ï¼š</strong>ç»Ÿä¸€ä½¿ç”¨ <code>settings.quiz_settings.collectionId</code>ï¼Œæ¸…ç†äº† <code>last-selected-textbook</code> åºŸä»£ç </li>
      <li><strong>é—®é¢˜2ä¿®å¤ï¼š</strong>ç”¨æˆ·å¯ä»¥ä¿®æ”¹å¤šä¸ªè®¾ç½®ï¼Œç‚¹å‡»"ä¿å­˜è®¾ç½®"æŒ‰é’®æ—¶ä¸€æ¬¡æ€§åŒæ­¥ï¼Œä¸å†æ˜¯ç‚¹é€‰å°±åŒæ­¥</li>
    </ul>
  </div>

  <h2>ğŸ” é—®é¢˜1éªŒè¯ï¼šæ•™æIDå­—æ®µç»Ÿä¸€</h2>
  <div class="test-step">
    <h3>æ­¥éª¤1: æ¸…ç†åºŸä»£ç éªŒè¯</h3>
    <div class="log info">
      <strong>âœ… å·²ç§»é™¤çš„åºŸä»£ç :</strong><br>
      1. TextbookSelectionPage ä¸å†å†™å…¥ localStorage.setItem('last-selected-textbook')<br>
      2. GuessWordSettingsPage ä¸å†ä» localStorage.getItem('last-selected-textbook') è¯»å–<br>
      <br>
      <strong>âœ… ç»Ÿä¸€ä½¿ç”¨å­—æ®µ:</strong><br>
      â€¢ <code>settings.collectionId</code> - ç»Ÿä¸€å­˜å‚¨æ•™æID<br>
      â€¢ <code>profile.settings.preferred_textbook_id</code> - åç«¯ç”¨æˆ·åå¥½<br>
      â€¢ <code>profile.settings.quiz_settings.collectionId</code> - åç«¯quizè®¾ç½®
    </div>
  </div>

  <div class="test-step">
    <h3>æ­¥éª¤2: éªŒè¯æ•™æé€‰æ‹©åŒæ­¥</h3>
    <div class="log">
      <strong>æµ‹è¯•æ­¥éª¤:</strong><br>
      1. ç™»å½•ç”¨æˆ·è´¦æˆ·<br>
      2. è¿›å…¥"çŒœå•è¯" â†’ "è®¾ç½®" â†’ "é€‰æ‹©æ•™æ"<br>
      3. é€‰æ‹©ä¸€ä¸ªæ•™æå¹¶ç¡®è®¤<br>
      4. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—:<br>
      <div class="code-block">
ğŸ“š [TextbookSelection] ç”¨æˆ·é€‰æ‹©æ•™æ: [æ•™æID]<br>
âœ… [useQuizSettings] è®¾ç½®å·²åŒæ­¥åˆ°åç«¯
      </div>
      <strong>éªŒè¯ç‚¹:</strong><br>
      âœ“ æ§åˆ¶å°æ²¡æœ‰ localStorage å†™å…¥ last-selected-textbook çš„æ—¥å¿—<br>
      âœ“ æ•™æé€‰æ‹©è‡ªåŠ¨åŒæ­¥åˆ°åç«¯
    </div>
  </div>

  <h2>ğŸ’¾ é—®é¢˜2éªŒè¯ï¼šæ‰¹é‡ä¿å­˜è®¾ç½®</h2>
  <div class="test-step">
    <h3>æ­¥éª¤3: æµ‹è¯•ç‚¹é€‰ä¸ç«‹å³åŒæ­¥</h3>
    <div class="log">
      <strong>æµ‹è¯•æ­¥éª¤:</strong><br>
      1. è¿›å…¥"çŒœå•è¯" â†’ "è®¾ç½®"<br>
      2. ä¿®æ”¹å¤šä¸ªè®¾ç½®ï¼ˆé¢˜å‹ã€ç­”é¢˜æ–¹å¼ã€å‡ºé¢˜ç­–ç•¥ç­‰ï¼‰<br>
      3. <strong style="color: red;">ä¸è¦ç‚¹å‡»ä¿å­˜æŒ‰é’®</strong><br>
      4. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—ï¼Œåº”è¯¥<strong style="color: red;">æ²¡æœ‰</strong>çœ‹åˆ°åŒæ­¥æ—¥å¿—<br>
      <br>
      <strong>é¢„æœŸç»“æœ:</strong><br>
      âœ“ ä¿®æ”¹è®¾ç½®æ—¶æ§åˆ¶å°æ— åŒæ­¥æ—¥å¿—<br>
      âœ“ é¡µé¢UIæ˜¾ç¤ºå·²é€‰æ‹©çš„è®¾ç½®<br>
      âœ“ åˆ·æ–°é¡µé¢åè®¾ç½®å›åˆ°ä¿®æ”¹å‰çŠ¶æ€ï¼ˆå› ä¸ºæœªä¿å­˜ï¼‰
    </div>
  </div>

  <div class="test-step">
    <h3>æ­¥éª¤4: æµ‹è¯•ç‚¹å‡»ä¿å­˜æŒ‰é’®åŒæ­¥</h3>
    <div class="log">
      <strong>æµ‹è¯•æ­¥éª¤:</strong><br>
      1. åœ¨è®¾ç½®é¡µé¢ä¿®æ”¹å¤šä¸ªè®¾ç½®<br>
      2. ç‚¹å‡»"ä¿å­˜è®¾ç½®"æŒ‰é’®<br>
      3. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—:<br>
      <div class="code-block">
ğŸ’¾ [GuessWordSettings] ç”¨æˆ·ç‚¹å‡»ä¿å­˜è®¾ç½®: {<br>
  questionType: "xxx",<br>
  answerType: "xxx",<br>
  selectionStrategy: "xxx",<br>
  collectionId: "xxx",<br>
  tts: { ... }<br>
}<br>
âœ… [useQuizSettings] è®¾ç½®å·²åŒæ­¥åˆ°åç«¯
      </div>
      <strong>éªŒè¯ç‚¹:</strong><br>
      âœ“ åªæœ‰ç‚¹å‡»ä¿å­˜æ—¶æ‰çœ‹åˆ°åŒæ­¥æ—¥å¿—<br>
      âœ“ ä¿å­˜åè·³è½¬åˆ°ä¸»é¡µ<br>
      âœ“ å†æ¬¡è¿›å…¥è®¾ç½®é¡µé¢ï¼Œè®¾ç½®ä¿æŒä¸ºä¿®æ”¹åçš„çŠ¶æ€
    </div>
  </div>

  <div class="test-step">
    <h3>æ­¥éª¤5: éªŒè¯åç«¯åŒæ­¥</h3>
    <div class="log">
      <strong>æ•°æ®åº“éªŒè¯:</strong><br>
      ä¿å­˜è®¾ç½®åï¼Œåœ¨ Supabase ä¸­æŸ¥è¯¢:<br>
      <div class="code-block">
SELECT settings->'quiz_settings' as quiz_settings<br>
FROM user_profiles<br>
WHERE id = 'ä½ çš„ç”¨æˆ·ID';
      </div>
      <strong>åº”è¯¥çœ‹åˆ°:</strong><br>
      âœ“ quiz_settings èŠ‚ç‚¹åŒ…å«æ‰€æœ‰ä¿®æ”¹çš„è®¾ç½®<br>
      âœ“ collectionId åŒæ­¥åˆ° quiz_settings.collectionId<br>
      âœ“ preferred_textbook_id ä¹Ÿæ›´æ–°ä¸ºç›¸åŒå€¼
    </div>
  </div>

  <h2>ğŸ§ª ç»¼åˆæµ‹è¯•åœºæ™¯</h2>

  <div class="test-step">
    <h3>åœºæ™¯1: æ–°ç”¨æˆ·é¦–æ¬¡ä½¿ç”¨</h3>
    <div class="log">
      1. æ‰“å¼€åº”ç”¨ï¼ˆæœªç™»å½•ï¼‰<br>
      2. è¿›å…¥"çŒœå•è¯" â†’ "è®¾ç½®"<br>
      3. å¼¹å‡ºç™»å½•æ¡†ï¼Œç™»å½•<br>
      4. ä¿®æ”¹è®¾ç½®å¹¶ä¿å­˜<br>
      5. éªŒè¯è®¾ç½®åŒæ­¥åˆ°åç«¯<br>
      6. åˆ·æ–°é¡µé¢ï¼Œè®¾ç½®ä¿æŒ
    </div>
  </div>

  <div class="test-step">
    <h3>åœºæ™¯2: è€ç”¨æˆ·æ•°æ®è¿ç§»</h3>
    <div class="log">
      1. å·²æœ‰ç”¨æˆ·ï¼Œä¹‹å‰ä½¿ç”¨è¿‡ old localStorage key<br>
      2. ç™»å½•åè¿›å…¥è®¾ç½®é¡µé¢<br>
      3. <strong>æ³¨æ„:</strong> ä¸å†ä¾èµ– last-selected-textbook<br>
      4. ç›´æ¥ä½¿ç”¨ profile.settings.preferred_textbook_id<br>
      5. è®¾ç½®ä¼˜å…ˆçº§: ç”¨æˆ·è®¾ç½® > æœåŠ¡å™¨é…ç½® > ç¡¬ç¼–ç 
    </div>
  </div>

  <div class="test-step">
    <h3>åœºæ™¯3: ä¿®æ”¹éƒ¨åˆ†è®¾ç½®</h3>
    <div class="log">
      1. è¿›å…¥è®¾ç½®é¡µé¢<br>
      2. åªä¿®æ”¹ TTS è¯­é€Ÿï¼ˆä¸ä¿®æ”¹å…¶ä»–è®¾ç½®ï¼‰<br>
      3. ç‚¹å‡»ä¿å­˜<br>
      4. éªŒè¯: åªåŒæ­¥ä¿®æ”¹çš„è¯­é€Ÿï¼Œå…¶ä»–è®¾ç½®ä¿æŒä¸å˜<br>
      5. <strong>éªŒè¯:</strong> ä½¿ç”¨æ·±åº¦åˆå¹¶ï¼Œä¸æ˜¯å…¨é‡æ›¿æ¢
    </div>
  </div>

  <h2>âœ… å®Œæˆæ£€æŸ¥æ¸…å•</h2>
  <div class="log success">
    <input type="checkbox"> TextbookSelectionPage ä¸å†å†™å…¥ last-selected-textbook<br>
    <input type="checkbox"> GuessWordSettingsPage ä¸å†è¯»å– last-selected-textbook<br>
    <input type="checkbox"> ä¿®æ”¹è®¾ç½®æ—¶æ§åˆ¶å°æ— åŒæ­¥æ—¥å¿—ï¼ˆç‚¹é€‰ä¸ç«‹å³åŒæ­¥ï¼‰<br>
    <input type="checkbox"> ç‚¹å‡»ä¿å­˜è®¾ç½®æ—¶çœ‹åˆ°åŒæ­¥æ—¥å¿—<br>
    <input type="checkbox"> æ§åˆ¶å°æ˜¾ç¤ºä¿å­˜çš„å®Œæ•´è®¾ç½®<br>
    <input type="checkbox"> æ•°æ®åº“ä¸­ quiz_settings èŠ‚ç‚¹æ­£ç¡®æ›´æ–°<br>
    <input type="checkbox"> é¡µé¢åˆ·æ–°åè®¾ç½®ä¿æŒ<br>
    <input type="checkbox"> ä¼˜å…ˆçº§æ­£ç¡®: ç”¨æˆ·è®¾ç½® > æœåŠ¡å™¨é…ç½® > ç¡¬ç¼–ç 
  </div>

  <h2>ğŸ“š å…³é”®æŠ€æœ¯å®ç°</h2>

  <div class="log info">
    <strong>æ‰¹é‡ä¿å­˜å®ç°:</strong><br>
    â€¢ æ·»åŠ  <code>pendingSettings</code> çŠ¶æ€å­˜å‚¨å¾…ä¿å­˜çš„è®¾ç½®<br>
    â€¢ æ‰€æœ‰è®¾ç½®å¤„ç†å‡½æ•°æ›´æ–° <code>pendingSettings</code> è€Œé <code>settings</code><br>
    â€¢ ç»„ä»¶æ¸²æŸ“ä½¿ç”¨ <code>(pendingSettings || settings)</code> æ˜¾ç¤ºå½“å‰å€¼<br>
    â€¢ ç‚¹å‡»ä¿å­˜æ—¶è°ƒç”¨ <code>setSettings(pendingSettings)</code> ä¸€æ¬¡æ€§åŒæ­¥
  </div>

  <div class="log info">
    <strong>åºŸä»£ç æ¸…ç†:</strong><br>
    â€¢ ç§»é™¤ <code>localStorage.setItem('last-selected-textbook')</code><br>
    â€¢ ç§»é™¤ <code>localStorage.getItem('last-selected-textbook')</code><br>
    â€¢ ç»Ÿä¸€ä½¿ç”¨ <code>settings.collectionId</code> ä½œä¸ºæ•™æID
  </div>

</body>
</html>