# å„¿ç«¥è¯†å­—é‡æµ‹è¯•æ¸¸æˆå®ç°æ€»ç»“

## æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº†å„¿ç«¥è¯†å­—é‡æµ‹è¯•æ¸¸æˆï¼ˆLiteracy Assessment Gameï¼‰çš„å®Œæ•´å®ç°è¿‡ç¨‹ã€‚è¯¥æ¸¸æˆæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€è‡ªåŒ…å«çš„åŠŸèƒ½æ¨¡å—ï¼Œéµå¾ªäº†é¡¹ç›®çš„è®¾è®¡è§„èŒƒå’Œæœ€ä½³å®è·µã€‚

## å®ç°çŠ¶æ€

### âœ… å·²å®Œæˆçš„ä»»åŠ¡

#### Task 1: åˆ›å»ºç±»å‹å®šä¹‰å’Œæ•°æ®æ¨¡å‹
- **æ–‡ä»¶**: `src/components/LiteracyAssessmentGame/types.ts`
- **å†…å®¹**: å®šä¹‰äº†æ‰€æœ‰ TypeScript æ¥å£ï¼ŒåŒ…æ‹¬ GamePhaseã€AssessmentSessionã€LevelPacketã€AssessmentQuestionã€LevelInfoã€PacketResultã€AssessmentReportã€ChartDataã€Conclusionã€GameState ç­‰
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 2: å®ç°æ ¸å¿ƒæ¸¸æˆçŠ¶æ€ç®¡ç† Hook
- **æ–‡ä»¶**: `src/components/LiteracyAssessmentGame/useLiteracyAssessmentGame.ts`
- **åŠŸèƒ½**:
  - æ¸¸æˆé˜¶æ®µè½¬æ¢ç®¡ç† (age-selection â†’ assessment â†’ level-transition â†’ result)
  - æµ‹è¯•ä¼šè¯çŠ¶æ€ç®¡ç†
  - å¹´é¾„éªŒè¯é€»è¾‘ (3-10å²)
  - é¢˜ç›®ç­”æ¡ˆéªŒè¯
  - base_set å’Œ rescue_set è¯„ä¼°é€»è¾‘
  - API è°ƒç”¨é›†æˆ
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 3: å®ç° API è°ƒç”¨å’Œæ•°æ®å¤„ç†
- **æ–‡ä»¶**: 
  - `src/utils/supabaseApi.ts` (æ·»åŠ äº† startAssessmentV6 å’Œ submitPacketV6 æ–¹æ³•)
  - `src/utils/api.ts` (æ›´æ–°äº† WordAPI æ¥å£)
  - `src/components/LiteracyAssessmentGame/apiValidation.ts` (æ•°æ®éªŒè¯å’Œè½¬æ¢)
- **åŠŸèƒ½**:
  - RPC å‡½æ•°è°ƒç”¨ (start_assessment_v6, submit_packet_v6)
  - é”™è¯¯å¤„ç†å’Œé‡è¯•é€»è¾‘
  - æ•°æ®éªŒè¯å’Œç±»å‹è½¬æ¢
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 4: å®ç°å¹´é¾„é€‰æ‹©ç»„ä»¶
- **æ–‡ä»¶**: `src/components/LiteracyAssessmentGame/AgeSelector.tsx`
- **åŠŸèƒ½**:
  - æ—¥æœŸé€‰æ‹©å™¨ï¼ˆå¹´/æœˆ/æ—¥ï¼‰
  - å®æ—¶å¹´é¾„è®¡ç®—å’Œæ˜¾ç¤º
  - å¹´é¾„éªŒè¯å’Œé”™è¯¯æç¤º
  - localStorage æŒä¹…åŒ–
  - å„¿ç«¥å‹å¥½çš„å½©è‰²ç•Œé¢
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 5: å®ç°é¢˜ç›®å±•ç¤ºç»„ä»¶
- **æ–‡ä»¶**: `src/components/LiteracyAssessmentGame/QuestionDisplay.tsx`
- **åŠŸèƒ½**:
  - æ˜¾ç¤º4ä¸ªé€‰é¡¹ï¼ˆæ­£ç¡®ç­”æ¡ˆ + æ··æ·†é€‰é¡¹ï¼‰
  - é€‰é¡¹éšæœºåŒ–
  - TTS è‡ªåŠ¨æ’­æ”¾ï¼ˆä¸­æ–‡ï¼‰
  - å³æ—¶åé¦ˆ
  - éŸ³æ•ˆé›†æˆ
  - å¤§å­—ä½“ã€æ¸…æ™°æŒ‰é’®
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 6: å®ç°ç­‰çº§è¿‡æ¸¡ç»„ä»¶
- **æ–‡ä»¶**: `src/components/LiteracyAssessmentGame/LevelTransition.tsx`
- **åŠŸèƒ½**:
  - æ˜¾ç¤ºç­‰çº§ä¿¡æ¯ï¼ˆtitle, pass_message, vocab_milestoneï¼‰
  - StarExplosion åº†ç¥åŠ¨ç”»
  - æˆåŠŸéŸ³æ•ˆ
  - è‡ªåŠ¨è¿‡æ¸¡ï¼ˆ3ç§’ï¼‰
  - æ‰‹åŠ¨ç»§ç»­æŒ‰é’®
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 7: å®ç°æ­£æ€åˆ†å¸ƒå›¾ç»„ä»¶
- **æ–‡ä»¶**: `src/components/LiteracyAssessmentGame/NormalDistributionChart.tsx`
- **åŠŸèƒ½**:
  - SVG ç»˜åˆ¶æ­£æ€åˆ†å¸ƒæ›²çº¿
  - å››ä¸ªç­‰çº§åŒºé—´æ ‡è®°ï¼ˆæ–°æ‰‹çº§ã€æ ‡å‡†çº§ã€é«˜æ‰‹çº§ã€å¤§å¸ˆçº§ï¼‰
  - ç”¨æˆ·ä½ç½®æ ‡è®°
  - å¤„ç†åˆ†æ•°è¶…å‡º max_val çš„æƒ…å†µ
  - å“åº”å¼è®¾è®¡
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 8: å®ç°ç»“æœå±•ç¤ºç»„ä»¶
- **æ–‡ä»¶**: `src/components/LiteracyAssessmentGame/ResultDisplay.tsx`
- **åŠŸèƒ½**:
  - é›†æˆ NormalDistributionChart
  - æ˜¾ç¤ºè¯†å­—é‡åˆ†æ•°ã€å¹´é¾„ã€ç™¾åˆ†ä½
  - æ˜¾ç¤ºç­‰çº§æ ‡é¢˜å’Œç»“è®ºæ–‡æœ¬
  - é‡æ–°æµ‹è¯•æŒ‰é’®
  - åˆ†äº«/ä¸‹è½½æŒ‰é’®ï¼ˆå ä½ç¬¦ï¼‰
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 9: å®ç°ä¸»æ¸¸æˆé¡µé¢ç»„ä»¶
- **æ–‡ä»¶**: 
  - `src/components/LiteracyAssessmentGame/LiteracyAssessmentGamePage.tsx`
  - `src/components/LiteracyAssessmentGame/index.ts`
- **åŠŸèƒ½**:
  - é›†æˆ useLiteracyAssessmentGame Hook
  - æ ¹æ® gamePhase æ¸²æŸ“ä¸åŒç»„ä»¶
  - é¡¶éƒ¨å¯¼èˆªæ ï¼ˆè¿”å›é¦–é¡µã€éŸ³æ•ˆæ§åˆ¶ï¼‰
  - é”™è¯¯å¤„ç†
  - åŠ è½½çŠ¶æ€
  - è¿›åº¦æŒ‡ç¤ºå™¨
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 10: é›†æˆåˆ°é¦–é¡µå’Œè·¯ç”±ç³»ç»Ÿ
- **ä¿®æ”¹çš„æ–‡ä»¶**:
  - `src/types/index.ts` (æ·»åŠ  'shizi_test' ç±»å‹)
  - `src/App.tsx` (æ·»åŠ  /literacy-assessment è·¯ç”±)
  - `src/components/HomePage.tsx` (æ·»åŠ æ¸¸æˆç±»å‹æ”¯æŒå’Œè·¯ç”±è·³è½¬)
- **åŠŸèƒ½**:
  - ç±»å‹å®šä¹‰æ›´æ–°
  - è·¯ç”±é…ç½®
  - é¦–é¡µæ¸¸æˆå¡ç‰‡è‡ªåŠ¨æ˜¾ç¤ºï¼ˆç”±åç«¯æ•°æ®é©±åŠ¨ï¼‰
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 11: å®ç°è¯„ä¼°é€»è¾‘å’Œç»“æœæäº¤
- **ä½ç½®**: `src/components/LiteracyAssessmentGame/useLiteracyAssessmentGame.ts`
- **åŠŸèƒ½**:
  - base_set è¯„ä¼°é€»è¾‘ï¼ˆæ­£ç¡®ç‡è®¡ç®—ã€é˜ˆå€¼åˆ¤æ–­ï¼‰
  - rescue_set è¯„ä¼°é€»è¾‘ï¼ˆæ€»æ­£ç¡®ç‡è®¡ç®—ï¼‰
  - ç»“æœæäº¤å’Œæµç¨‹æ§åˆ¶
  - æå‰ç»ˆæ­¢é€»è¾‘
  - ä¼šè¯ç»§ç»­é€»è¾‘
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 12: å®ç°éŸ³æ•ˆé›†æˆ
- **é›†æˆä½ç½®**:
  - QuestionDisplay: ç‚¹å‡»éŸ³æ•ˆã€æ­£ç¡®/é”™è¯¯éŸ³æ•ˆ
  - LevelTransition: æˆåŠŸéŸ³æ•ˆ
  - LiteracyAssessmentGamePage: æŒ‰é’®ç‚¹å‡»éŸ³æ•ˆã€éŸ³æ•ˆåˆ‡æ¢
- **ä½¿ç”¨**: useAppStore çš„ playSound æ–¹æ³•
- **çŠ¶æ€**: âœ… å®Œæˆ

#### Task 13: Checkpoint - ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
- **æ£€æŸ¥é¡¹**:
  - âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
  - âœ… æ‰€æœ‰ç»„ä»¶æ— è¯Šæ–­é”™è¯¯
  - âœ… å¯¼å…¥å¯¼å‡ºæ­£ç¡®
  - âœ… è·¯ç”±é…ç½®æ­£ç¡®
- **çŠ¶æ€**: âœ… å®Œæˆ

### ğŸ”„ å¾…å®Œæˆçš„ä»»åŠ¡

#### Task 14: ç«¯åˆ°ç«¯æµ‹è¯•å’Œä¼˜åŒ–
- **å­ä»»åŠ¡**:
  - [ ] 14.1 è¿›è¡Œå®Œæ•´æµç¨‹æµ‹è¯•
  - [ ] 14.2 æ€§èƒ½ä¼˜åŒ–
  - [ ] 14.3 æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
- **çŠ¶æ€**: ğŸ”„ éœ€è¦å®é™…è¿è¡Œæµ‹è¯•

#### Task 15: æœ€ç»ˆæ£€æŸ¥å’Œæ–‡æ¡£
- **å­ä»»åŠ¡**:
  - [ ] 15.1 ä»£ç å®¡æŸ¥å’Œæ¸…ç†
  - [ ] 15.2 æ›´æ–°ç›¸å…³æ–‡æ¡£
- **çŠ¶æ€**: ğŸ”„ å¾…å®Œæˆ

## æ–‡ä»¶ç»“æ„

```
src/components/LiteracyAssessmentGame/
â”œâ”€â”€ index.ts                          # ç»„ä»¶å¯¼å‡ºæ–‡ä»¶
â”œâ”€â”€ types.ts                          # ç±»å‹å®šä¹‰
â”œâ”€â”€ useLiteracyAssessmentGame.ts      # æ ¸å¿ƒ Hook
â”œâ”€â”€ apiValidation.ts                  # API æ•°æ®éªŒè¯
â”œâ”€â”€ LiteracyAssessmentGamePage.tsx    # ä¸»é¡µé¢ç»„ä»¶
â”œâ”€â”€ AgeSelector.tsx                   # å¹´é¾„é€‰æ‹©ç»„ä»¶
â”œâ”€â”€ QuestionDisplay.tsx               # é¢˜ç›®å±•ç¤ºç»„ä»¶
â”œâ”€â”€ LevelTransition.tsx               # ç­‰çº§è¿‡æ¸¡ç»„ä»¶
â”œâ”€â”€ NormalDistributionChart.tsx       # æ­£æ€åˆ†å¸ƒå›¾ç»„ä»¶
â””â”€â”€ ResultDisplay.tsx                 # ç»“æœå±•ç¤ºç»„ä»¶
```

## æŠ€æœ¯ç‰¹ç‚¹

### 1. ç‹¬ç«‹æ€§
- æ‰€æœ‰æ–‡ä»¶é›†ä¸­åœ¨ `src/components/LiteracyAssessmentGame/` ç›®å½•
- ä¸ä¾èµ–å…¶ä»–æ¸¸æˆç±»å‹çš„ä»£ç 
- å®Œå…¨è‡ªåŒ…å«çš„åŠŸèƒ½æ¨¡å—

### 2. ç±»å‹å®‰å…¨
- å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥
- API å“åº”æ•°æ®éªŒè¯

### 3. ç”¨æˆ·ä½“éªŒ
- å„¿ç«¥å‹å¥½çš„å½©è‰²ç•Œé¢
- å¤§å­—ä½“ã€æ¸…æ™°æŒ‰é’®
- å³æ—¶åé¦ˆ
- åº†ç¥åŠ¨ç”»
- éŸ³æ•ˆé›†æˆ

### 4. æ•°æ®æŒä¹…åŒ–
- localStorage ä¿å­˜å‡ºç”Ÿæ—¥æœŸ
- ä¼šè¯çŠ¶æ€ç®¡ç†
- ç»“æœæäº¤å’Œæ¢å¤

### 5. é”™è¯¯å¤„ç†
- API è°ƒç”¨é”™è¯¯å¤„ç†
- å¹´é¾„éªŒè¯
- æ•°æ®éªŒè¯
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

## API é›†æˆ

### åç«¯ RPC å‡½æ•°

#### 1. start_assessment_v6
- **è¾“å…¥**: birth_date (string)
- **è¾“å‡º**: 
  - session_id
  - packets (LevelPacket[])
  - status ('active')

#### 2. submit_packet_v6
- **è¾“å…¥**: 
  - session_id (string)
  - results (PacketResult[])
- **è¾“å‡º**:
  - status ('active' | 'completed')
  - packets (LevelPacket[], å¯é€‰)
  - report (AssessmentReport, å¯é€‰)

### æ•°æ®æµ

```
1. ç”¨æˆ·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ
   â†“
2. è°ƒç”¨ start_assessment_v6
   â†“
3. è·å–ç¬¬ä¸€ä¸ªé¢˜åŒ…
   â†“
4. ç”¨æˆ·ç­”é¢˜ï¼ˆbase_setï¼‰
   â†“
5. è¯„ä¼°ç»“æœ
   â”œâ”€ é€šè¿‡ â†’ æ˜¾ç¤ºç­‰çº§è¿‡æ¸¡ â†’ ç»§ç»­ä¸‹ä¸€é¢˜åŒ…
   â”œâ”€ å¤±è´¥ â†’ è°ƒç”¨ submit_packet_v6 â†’ æ˜¾ç¤ºç»“æœ
   â””â”€ è§¦å‘æ€¥æ•‘ â†’ ç­”æ€¥æ•‘é¢˜ï¼ˆrescue_setï¼‰â†’ è¯„ä¼°æ€»æ­£ç¡®ç‡
      â”œâ”€ é€šè¿‡ â†’ æ˜¾ç¤ºç­‰çº§è¿‡æ¸¡ â†’ ç»§ç»­ä¸‹ä¸€é¢˜åŒ…
      â””â”€ å¤±è´¥ â†’ è°ƒç”¨ submit_packet_v6 â†’ æ˜¾ç¤ºç»“æœ
```

## åç«¯é…ç½®è¦æ±‚

### æ•°æ®åº“è¡¨ï¼šgames

éœ€è¦åœ¨ `games` è¡¨ä¸­æ·»åŠ è¯†å­—é‡æµ‹è¯•æ¸¸æˆè®°å½•ï¼š

```sql
INSERT INTO games (
  id,
  title,
  description,
  icon,
  type,
  language,
  is_active,
  default_config
) VALUES (
  'literacy-assessment',
  'å„¿ç«¥è¯†å­—é‡æµ‹è¯•',
  'ç§‘å­¦è¯„ä¼°3-10å²å„¿ç«¥çš„è¯†å­—é‡æ°´å¹³ï¼Œæä¾›ä¸ªæ€§åŒ–å­¦ä¹ å»ºè®®',
  'BookCheck',  -- æˆ– 'GraduationCap'
  'shizi_test',
  'zh',
  true,
  '{}'::jsonb
);
```

### RPC å‡½æ•°

ç¡®ä¿ä»¥ä¸‹ RPC å‡½æ•°å·²éƒ¨ç½²ï¼š
- `start_assessment_v6(birth_date text)`
- `submit_packet_v6(session_id text, results jsonb)`

## æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [ ] å¹´é¾„é€‰æ‹©å’ŒéªŒè¯
- [ ] å‡ºç”Ÿæ—¥æœŸæŒä¹…åŒ–
- [ ] é¢˜ç›®æ˜¾ç¤ºå’Œé€‰é¡¹éšæœºåŒ–
- [ ] TTS éŸ³é¢‘æ’­æ”¾
- [ ] ç­”æ¡ˆæäº¤å’Œåé¦ˆ
- [ ] base_set è¯„ä¼°é€»è¾‘
- [ ] rescue_set è§¦å‘å’Œè¯„ä¼°
- [ ] ç­‰çº§è¿‡æ¸¡åŠ¨ç”»
- [ ] ç»“æœå±•ç¤ºå’Œæ­£æ€åˆ†å¸ƒå›¾
- [ ] é‡æ–°æµ‹è¯•åŠŸèƒ½
- [ ] éŸ³æ•ˆæ’­æ”¾
- [ ] è¿”å›é¦–é¡µ

### è¾¹ç•Œæµ‹è¯•
- [ ] å¹´é¾„ < 3 å²
- [ ] å¹´é¾„ > 10 å²
- [ ] ç½‘ç»œé”™è¯¯å¤„ç†
- [ ] API å“åº”é”™è¯¯å¤„ç†
- [ ] åˆ†æ•°è¶…å‡º max_val

### æµè§ˆå™¨å…¼å®¹æ€§
- [ ] Chrome
- [ ] Safari
- [ ] Firefox
- [ ] Edge
- [ ] ç§»åŠ¨ç«¯æµè§ˆå™¨

### æ€§èƒ½æµ‹è¯•
- [ ] ç»„ä»¶æ¸²æŸ“æ€§èƒ½
- [ ] TTS æ’­æ”¾æµç•…åº¦
- [ ] åŠ¨ç”»æµç•…åº¦
- [ ] å†…å­˜ä½¿ç”¨

## å·²çŸ¥é™åˆ¶

1. **å¯é€‰æµ‹è¯•ä»»åŠ¡æœªå®ç°**: ä¸ºäº†åŠ å¿« MVP å¼€å‘ï¼Œæ ‡è®°ä¸º `*` çš„æµ‹è¯•ä»»åŠ¡ï¼ˆå•å…ƒæµ‹è¯•ã€å±æ€§æµ‹è¯•ï¼‰æœªå®ç°
2. **åˆ†äº«/ä¸‹è½½åŠŸèƒ½**: ResultDisplay ä¸­çš„åˆ†äº«å’Œä¸‹è½½æŒ‰é’®ä¸ºå ä½ç¬¦ï¼ŒåŠŸèƒ½æœªå®ç°
3. **åç«¯ä¾èµ–**: éœ€è¦åç«¯ RPC å‡½æ•°å’Œæ•°æ®åº“é…ç½®æ‰èƒ½å®Œæ•´è¿è¡Œ

## ä¸‹ä¸€æ­¥

1. **åç«¯é…ç½®**: åœ¨æ•°æ®åº“ä¸­æ·»åŠ æ¸¸æˆè®°å½•ï¼Œç¡®ä¿ RPC å‡½æ•°å·²éƒ¨ç½²
2. **ç«¯åˆ°ç«¯æµ‹è¯•**: è¿è¡Œåº”ç”¨ç¨‹åºï¼Œæµ‹è¯•å®Œæ•´æµç¨‹
3. **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®æµ‹è¯•ç»“æœä¼˜åŒ–æ€§èƒ½
4. **æµè§ˆå™¨å…¼å®¹æ€§**: æµ‹è¯•å¹¶ä¿®å¤å…¼å®¹æ€§é—®é¢˜
5. **ä»£ç æ¸…ç†**: ç§»é™¤è°ƒè¯•ä»£ç ï¼Œæ·»åŠ å¿…è¦æ³¨é‡Š
6. **æ–‡æ¡£æ›´æ–°**: æ›´æ–° README å’Œä½¿ç”¨è¯´æ˜

## æ€»ç»“

å„¿ç«¥è¯†å­—é‡æµ‹è¯•æ¸¸æˆçš„å‰ç«¯å®ç°å·²åŸºæœ¬å®Œæˆï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½å·²å®ç°å¹¶é€šè¿‡äº† TypeScript ç±»å‹æ£€æŸ¥ã€‚æ¸¸æˆé‡‡ç”¨äº†ç‹¬ç«‹çš„æ–‡ä»¶ç»„ç»‡ç»“æ„ï¼Œéµå¾ªäº†é¡¹ç›®çš„è®¾è®¡è§„èŒƒï¼Œå…·æœ‰è‰¯å¥½çš„ç±»å‹å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

ä¸‹ä¸€æ­¥éœ€è¦è¿›è¡Œå®é™…çš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œå¹¶æ ¹æ®æµ‹è¯•ç»“æœè¿›è¡Œä¼˜åŒ–å’Œè°ƒæ•´ã€‚åŒæ—¶éœ€è¦ç¡®ä¿åç«¯é…ç½®æ­£ç¡®ï¼Œä»¥ä¾¿æ¸¸æˆèƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚
