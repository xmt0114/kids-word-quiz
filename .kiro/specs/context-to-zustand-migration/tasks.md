# Context到Zustand迁移实施计划

## 任务列表

- [x] 1. 创建新的Slice结构和基础设施





  - 创建src/stores/slices目录结构
  - 创建src/stores/selectors目录结构
  - 设置slice和选择器的导出文件
  - _需求: 2.1, 2.3, 2.4_

- [x] 1.1 创建配置管理slice (configSlice.ts)


  - 实现ConfigSlice接口和状态管理
  - 迁移useAppConfig的所有逻辑到slice中
  - 实现配置优先级处理（用户配置 > 游客配置 > 默认配置）
  - 添加配置加载、错误处理和刷新功能
  - _需求: 4.1, 4.2, 4.4, 4.5_

- [x] 1.2 为配置slice编写属性测试


  - **属性 6: 配置获取一致性**
  - **属性 7: 配置优先级正确性**
  - **验证: 需求 4.1, 4.5**

- [x] 1.3 创建UI状态管理slice (uiSlice.ts)


  - 实现UISlice接口和模态框状态管理
  - 从appStore中提取loginModal相关逻辑
  - 添加密码设置模态框、全局加载和通知状态管理
  - _需求: 6.1, 6.2, 6.3, 6.4_

- [x] 1.4 为UI slice编写属性测试


  - **属性 9: UI状态管理集中性**
  - **验证: 需求 6.1, 6.2, 6.3**

- [x] 1.5 重构认证slice (authSlice.ts)


  - 从appStore中提取认证相关逻辑到独立slice
  - 简化认证状态管理接口
  - 保持与现有useAuth hook的兼容性
  - _需求: 5.1, 5.2, 5.4_

- [x] 1.6 为认证slice编写属性测试


  - **属性 8: 认证状态访问直接性**
  - **验证: 需求 5.1**

- [x] 2. 更新主store集成所有slice



  - 修改appStore.ts集成新创建的slice
  - 确保slice之间的正确交互
  - 更新现有的选择器和辅助函数
  - 保持向后兼容性
  - _需求: 2.4, 1.2_

- [x] 2.1 为store集成编写单元测试


  - 测试slice集成的正确性
  - 测试选择器的功能
  - 测试actions的副作用
  - _需求: 2.4_

- [x] 3. 迁移配置管理功能


  - 更新ConfigProvider使用新的configSlice
  - 创建配置相关的选择器函数
  - 确保配置加载逻辑的完整迁移
  - _需求: 4.1, 4.3, 4.4_

- [x] 3.1 更新使用配置的组件


  - 将所有使用useAppContext的地方改为使用configSlice
  - 更新配置获取方式为Zustand选择器
  - 确保配置更新机制正常工作
  - _需求: 1.3, 4.3_

- [x] 3.2 为配置迁移编写集成测试


  - 测试配置加载的完整流程
  - 测试用户和游客模式的配置切换
  - 测试配置更新的正确性
  - _需求: 4.5_

- [x] 4. 第一次验证检查点


  - 确保所有测试通过，询问用户是否有问题

- [ ] 5. 移除Context Provider依赖



  - 移除AppContextProvider的使用
  - 更新App.tsx移除ConfigProvider包装
  - 移除AuthProvider包装，直接使用Zustand
  - _需求: 1.1, 5.3_

- [x] 5.1 更新应用初始化逻辑


  - 修改Gatekeeper组件直接使用Zustand store
  - 确保应用启动时正确初始化所有slice
  - 移除对Context的依赖
  - _需求: 1.2, 5.3_

- [x] 5.2 为Provider移除编写验证测试


  - **属性 1: Context代码完全移除**
  - **属性 2: 状态访问统一性**
  - **验证: 需求 1.1, 1.3**

- [x] 6. 清理和验证



  - 删除未使用的Context相关文件
  - 删除useAppContext.tsx和ConfigProvider.tsx
  - 清理AuthProvider.tsx中的Context包装
  - _需求: 1.1, 7.1_

- [x] 6.1 运行完整性验证


  - 执行静态代码分析检查Context残留
  - 运行所有现有测试确保功能完整性
  - 验证应用在所有主要流程中正常工作
  - _需求: 7.1, 7.2, 7.3_

- [x] 6.2 编写迁移完整性测试


  - **属性 3: 状态更新统一性**
  - **属性 4: 功能完整性保持**
  - **验证: 需求 1.4, 1.5, 3.5**

- [x] 7. 性能优化和文档更新



  - 优化选择器避免不必要的重渲染
  - 添加性能监控和对比
  - 更新相关文档和注释
  - _需求: 2.2_

- [x] 7.1 编写性能验证测试


  - 对比迁移前后的渲染性能
  - 验证状态订阅的效率
  - 测试大量状态更新的性能
  - _需求: 2.2_

- [x] 8. 最终验证检查点


  - 确保所有测试通过，询问用户是否有问题

- [x] 9. 生成迁移完整性报告



  - 创建迁移前后的对比报告
  - 统计移除的Context代码行数
  - 记录性能改进数据
  - 提供迁移成功验证清单
  - _需求: 7.5_