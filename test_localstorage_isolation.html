<!DOCTYPE html>
<html>
<head>
  <title>localStorageç”¨æˆ·æ•°æ®éš”ç¦»æµ‹è¯•æŒ‡å—</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; background: #f0f2f5; }
    h1 { color: #1a365d; border-bottom: 3px solid #3182ce; padding-bottom: 10px; }
    h2 { color: #2c5282; margin-top: 30px; }
    .log { background: #f7fafc; padding: 15px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #3182ce; }
    .success { color: #22543d; }
    .error { color: #742a2a; }
    .warning { color: #744210; }
    .info { color: #2c5282; }
    code { background: #2d3748; color: #e2e8f0; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; }
    .code-block { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 8px; overflow-x: auto; margin: 10px 0; }
    .highlight { background: #fef5e7; padding: 15px; border-left: 4px solid #f59e0b; margin: 15px 0; border-radius: 4px; }
    .test-step { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>ğŸ”’ localStorageç”¨æˆ·æ•°æ®éš”ç¦»æµ‹è¯•æŒ‡å—</h1>

  <div class="highlight">
    <strong>âœ¨ ä¿®å¤å†…å®¹ï¼š</strong>
    <ul>
      <li><strong>æ•°æ®éš”ç¦»ï¼š</strong> ä¸åŒç™»å½•ç”¨æˆ·çš„localStorageæ•°æ®å®Œå…¨éš”ç¦»</li>
      <li><strong>æœªç™»å½•ç”¨æˆ·ï¼š</strong> ä½¿ç”¨è®¾å¤‡IDåŒºåˆ†ä¸åŒè®¾å¤‡ï¼Œæœªç™»å½•ç”¨æˆ·æ•°æ®ä¸ä¼šæ··æ·†</li>
      <li><strong>Keyæ ¼å¼ï¼š</strong> ç™»å½•ç”¨æˆ·ä½¿ç”¨ <code>key_user_{userId}</code>ï¼Œæœªç™»å½•ç”¨æˆ·ä½¿ç”¨ <code>key_anonymous_{deviceId}</code></li>
      <li><strong>ä¿åº•æœºåˆ¶ï¼š</strong> æœªç™»å½•ç”¨æˆ·å¯ä»¥ç›´æ¥ä½¿ç”¨app_configçš„æœåŠ¡å™¨é…ç½®</li>
    </ul>
  </div>

  <h2>ğŸ” ä¿®å¤å‰åå¯¹æ¯”</h2>

  <div class="test-step">
    <h3>ä¿®å¤å‰ï¼ˆé—®é¢˜ï¼‰</h3>
    <div class="log error">
      <strong>æ‰€æœ‰ç”¨æˆ·å…±äº«åŒä¸€ä¸ªlocalStorage keyï¼š</strong><br>
      â€¢ <code>'quiz-settings'</code> - æ‰€æœ‰ç”¨æˆ·å…±äº«<br>
      â€¢ <code>'quiz-stats'</code> - æ‰€æœ‰ç”¨æˆ·å…±äº«<br>
      â€¢ <code>'learning-progress'</code> - æ‰€æœ‰ç”¨æˆ·å…±äº«<br>
      <br>
      <strong>å¯¼è‡´çš„é—®é¢˜ï¼š</strong><br>
      âŒ ç”¨æˆ·Açš„è®¾ç½®è¦†ç›–ç”¨æˆ·Bçš„è®¾ç½®<br>
      âŒ ç”¨æˆ·Açš„æ¸¸æˆæ¬¡æ•°åŠ åˆ°ç”¨æˆ·Bçš„ç»Ÿè®¡ä¸Š<br>
      âŒ ç”¨æˆ·Açš„å­¦ä¹ è¿›åº¦è¦†ç›–ç”¨æˆ·Bçš„è¿›åº¦
    </div>
  </div>

  <div class="test-step">
    <h3>ä¿®å¤åï¼ˆæ­£å¸¸ï¼‰</h3>
    <div class="log success">
      <strong>æ¯ä¸ªç”¨æˆ·ä½¿ç”¨ç‹¬ç«‹çš„localStorage keyï¼š</strong><br>
      â€¢ <code>'quiz-settings_user_{userId_A}'</code> - ç”¨æˆ·Aä¸“ç”¨<br>
      â€¢ <code>'quiz-settings_user_{userId_B}'</code> - ç”¨æˆ·Bä¸“ç”¨<br>
      â€¢ <code>'quiz-stats_user_{userId_A}'</code> - ç”¨æˆ·Aä¸“ç”¨<br>
      â€¢ <code>'quiz-stats_user_{userId_B}'</code> - ç”¨æˆ·Bä¸“ç”¨<br>
      â€¢ <code>'learning-progress_user_{userId_A}'</code> - ç”¨æˆ·Aä¸“ç”¨<br>
      â€¢ <code>'learning-progress_user_{userId_B}'</code> - ç”¨æˆ·Bä¸“ç”¨<br>
      <br>
      <strong>æœªç™»å½•ç”¨æˆ·ï¼š</strong><br>
      â€¢ <code>'quiz-settings_anonymous_{deviceId}'</code> - è®¾å¤‡ä¸“ç”¨<br>
      â€¢ <code>'quiz-stats_anonymous_{deviceId}'</code> - è®¾å¤‡ä¸“ç”¨<br>
      â€¢ <code>'learning-progress_anonymous_{deviceId}'</code> - è®¾å¤‡ä¸“ç”¨
    </div>
  </div>

  <h2>ğŸ§ª æµ‹è¯•åœºæ™¯1: ç™»å½•ç”¨æˆ·æ•°æ®éš”ç¦»</h2>

  <div class="test-step">
    <h3>æ­¥éª¤1: ç”¨æˆ·Aç™»å½•å¹¶ä¿®æ”¹è®¾ç½®</h3>
    <div class="log">
      <strong>æ“ä½œï¼š</strong><br>
      1. ä½¿ç”¨æµè§ˆå™¨Aï¼ˆæ¨èChromeï¼‰è®¿é—®åº”ç”¨<br>
      2. æ³¨å†Œ/ç™»å½•ç”¨æˆ·Aï¼ˆé‚®ç®±: userA@test.comï¼‰<br>
      3. è¿›å…¥"çŒœå•è¯" â†’ "è®¾ç½®"<br>
      4. ä¿®æ”¹è®¾ç½®ä¸ºï¼šé¢˜å‹='éŸ³é¢‘é¢˜å¹²', ç­”é¢˜æ–¹å¼='å¡«ç©ºé¢˜'<br>
      5. ç‚¹å‡»"ä¿å­˜è®¾ç½®"<br>
      <br>
      <strong>é¢„æœŸæ§åˆ¶å°æ—¥å¿—ï¼š</strong><br>
      <div class="code-block">
ğŸ’¾ [GuessWordSettings] ç”¨æˆ·ç‚¹å‡»ä¿å­˜è®¾ç½®: {<br>
  questionType: "audio",<br>
  answerType: "fill",<br>
  ...<br>
}<br>
ğŸ’¾ [useLocalStorage] ä¿å­˜åˆ°localStorage: {<br>
  key: "quiz-settings_user_[userAçš„ID]",<br>
  value: {...}<br>
}<br>
âœ… [useQuizSettings] è®¾ç½®å·²åŒæ­¥åˆ°åç«¯
      </div>
    </div>
  </div>

  <div class="test-step">
    <h3>æ­¥éª¤2: ç”¨æˆ·Bç™»å½•å¹¶ä¿®æ”¹è®¾ç½®</h3>
    <div class="log">
      <strong>æ“ä½œï¼š</strong><br>
      1. ä½¿ç”¨æµè§ˆå™¨Bï¼ˆæ¨èFirefoxæˆ–Chromeæ— ç—•æ¨¡å¼ï¼‰è®¿é—®åº”ç”¨<br>
      2. æ³¨å†Œ/ç™»å½•ç”¨æˆ·Bï¼ˆé‚®ç®±: userB@test.comï¼‰<br>
      3. è¿›å…¥"çŒœå•è¯" â†’ "è®¾ç½®"<br>
      4. ä¿®æ”¹è®¾ç½®ä¸ºï¼šé¢˜å‹='æ–‡å­—é¢˜å¹²', ç­”é¢˜æ–¹å¼='é€‰æ‹©é¢˜'<br>
      5. ç‚¹å‡»"ä¿å­˜è®¾ç½®"<br>
      <br>
      <strong>é¢„æœŸæ§åˆ¶å°æ—¥å¿—ï¼š</strong><br>
      <div class="code-block">
ğŸ’¾ [GuessWordSettings] ç”¨æˆ·ç‚¹å‡»ä¿å­˜è®¾ç½®: {<br>
  questionType: "text",<br>
  answerType: "choice",<br>
  ...<br>
}<br>
ğŸ’¾ [useLocalStorage] ä¿å­˜åˆ°localStorage: {<br>
  key: "quiz-settings_user_[userBçš„ID]",<br>
  value: {...}<br>
}<br>
âœ… [useQuizSettings] è®¾ç½®å·²åŒæ­¥åˆ°åç«¯
      </div>
    </div>
  </div>

  <div class="test-step">
    <h3>æ­¥éª¤3: éªŒè¯æ•°æ®éš”ç¦»</h3>
    <div class="log success">
      <strong>æ“ä½œï¼š</strong><br>
      1. åœ¨æµè§ˆå™¨Aä¸­åˆ·æ–°é¡µé¢ï¼Œæ£€æŸ¥è®¾ç½®æ˜¯å¦ä¿æŒä¸ºï¼šé¢˜å‹='éŸ³é¢‘é¢˜å¹²', ç­”é¢˜æ–¹å¼='å¡«ç©ºé¢˜'<br>
      2. åœ¨æµè§ˆå™¨Bä¸­åˆ·æ–°é¡µé¢ï¼Œæ£€æŸ¥è®¾ç½®æ˜¯å¦ä¿æŒä¸ºï¼šé¢˜å‹='æ–‡å­—é¢˜å¹²', ç­”é¢˜æ–¹å¼='é€‰æ‹©é¢˜'<br>
      3. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Application â†’ Local Storageï¼Œæ£€æŸ¥ï¼š<br>
      <br>
      <strong>åº”è¯¥çœ‹åˆ°ï¼š</strong><br>
      â€¢ Chrome: <code>quiz-settings_user_[userAçš„ID]</code> = { questionType: "audio", answerType: "fill" }<br>
      â€¢ Firefox: <code>quiz-settings_user_[userBçš„ID]</code> = { questionType: "text", answerType: "choice" }<br>
      <br>
      <strong>âœ… éªŒè¯é€šè¿‡ï¼š</strong><br>
      âœ“ ç”¨æˆ·Aå’Œç”¨æˆ·Bçš„è®¾ç½®å®Œå…¨éš”ç¦»<br>
      âœ“ å„è‡ªçœ‹åˆ°è‡ªå·±çš„è®¾ç½®ï¼Œäº’ä¸å½±å“<br>
      âœ“ localStorage keyåŒ…å«ç”¨æˆ·IDå‰ç¼€
    </div>
  </div>

  <h2>ğŸ§ª æµ‹è¯•åœºæ™¯2: æœªç™»å½•ç”¨æˆ·æ•°æ®éš”ç¦»</h2>

  <div class="test-step">
    <h3>æ­¥éª¤1: æœªç™»å½•ç”¨æˆ·Aä½¿ç”¨åº”ç”¨</h3>
    <div class="log">
      <strong>æ“ä½œï¼š</strong><br>
      1. æ‰“å¼€Chromeæ— ç—•æ¨¡å¼ï¼ˆæˆ–æ¸…é™¤localStorageåï¼‰<br>
      2. <strong style="color: red;">ä¸ç™»å½•</strong>ï¼Œç›´æ¥è®¿é—®åº”ç”¨<br>
      3. è¿›å…¥"çŒœå•è¯" â†’ "è®¾ç½®"<br>
      4. ä¿®æ”¹è®¾ç½®å¹¶ä¿å­˜<br>
      <br>
      <strong>é¢„æœŸæ§åˆ¶å°æ—¥å¿—ï¼š</strong><br>
      <div class="code-block">
ğŸ” [useQuizSettings] è·å–é»˜è®¤è®¾ç½®: {<br>
  isLoggedIn: false,<br>
  from: "æœåŠ¡å™¨é…ç½®",<br>
  finalSettings: {...}<br>
}<br>
ğŸ’¾ [GuessWordSettings] ç”¨æˆ·ç‚¹å‡»ä¿å­˜è®¾ç½®: {...}<br>
ğŸ’¾ [useLocalStorage] ä¿å­˜åˆ°localStorage: {<br>
  key: "quiz-settings_anonymous_[deviceId]",<br>
  value: {...}<br>
}<br>
âš ï¸ [useQuizSettings] ç”¨æˆ·æœªç™»å½•ï¼Œè·³è¿‡åŒæ­¥åˆ°åç«¯
      </div>
    </div>
  </div>

  <div class="test-step">
    <h3>æ­¥éª¤2: æœªç™»å½•ç”¨æˆ·Bä½¿ç”¨åº”ç”¨</h3>
    <div class="log">
      <strong>æ“ä½œï¼š</strong><br>
      1. æ‰“å¼€Firefoxæµè§ˆå™¨ï¼ˆæˆ–Chromeå¦ä¸€ä¸ªæ— ç—•çª—å£ï¼‰<br>
      2. <strong style="color: red;">ä¸ç™»å½•</strong>ï¼Œç›´æ¥è®¿é—®åº”ç”¨<br>
      3. è¿›å…¥"çŒœå•è¯" â†’ "è®¾ç½®"<br>
      4. ä¿®æ”¹ä¸ºä¸åŒçš„è®¾ç½®å¹¶ä¿å­˜<br>
      <br>
      <strong>é¢„æœŸæ§åˆ¶å°æ—¥å¿—ï¼š</strong><br>
      <div class="code-block">
ğŸ” [useQuizSettings] è·å–é»˜è®¤è®¾ç½®: {<br>
  isLoggedIn: false,<br>
  from: "æœåŠ¡å™¨é…ç½®",<br>
  finalSettings: {...}<br>
}<br>
ğŸ’¾ [GuessWordSettings] ç”¨æˆ·ç‚¹å‡»ä¿å­˜è®¾ç½®: {...}<br>
ğŸ’¾ [useLocalStorage] ä¿å­˜åˆ°localStorage: {<br>
  key: "quiz-settings_anonymous_[ä¸åŒçš„deviceId]",<br>
  value: {...}<br>
}
      </div>
    </div>
  </div>

  <div class="test-step">
    <h3>æ­¥éª¤3: éªŒè¯æœªç™»å½•ç”¨æˆ·æ•°æ®éš”ç¦»</h3>
    <div class="log success">
      <strong>æ“ä½œï¼š</strong><br>
      1. åœ¨Chromeæ— ç—•çª—å£ä¸­åˆ·æ–°é¡µé¢ï¼Œæ£€æŸ¥è®¾ç½®ä¿æŒ<br>
      2. åœ¨Firefoxçª—å£ä¸­åˆ·æ–°é¡µé¢ï¼Œæ£€æŸ¥è®¾ç½®ä¿æŒ<br>
      3. æ£€æŸ¥localStorageï¼Œåº”è¯¥çœ‹åˆ°ï¼š<br>
      <br>
      <strong>åº”è¯¥çœ‹åˆ°ï¼š</strong><br>
      â€¢ Chrome: <code>device_id</code> = "device_xxx_xxx"ï¼ˆè®¾å¤‡IDï¼‰<br>
      â€¢ Chrome: <code>quiz-settings_anonymous_device_xxx_xxx</code> = { è®¾ç½®A }<br>
      â€¢ Firefox: <code>device_id</code> = "device_yyy_yyy"ï¼ˆä¸åŒçš„è®¾å¤‡IDï¼‰<br>
      â€¢ Firefox: <code>quiz-settings_anonymous_device_yyy_yyy</code> = { è®¾ç½®B }<br>
      <br>
      <strong>âœ… éªŒè¯é€šè¿‡ï¼š</strong><br>
      âœ“ ä¸åŒè®¾å¤‡çš„æœªç™»å½•ç”¨æˆ·æ•°æ®éš”ç¦»<br>
      âœ“ ä½¿ç”¨è®¾å¤‡IDä½œä¸ºæ ‡è¯†ç¬¦<br>
      âœ“ æœªç™»å½•ç”¨æˆ·ä½¿ç”¨æœåŠ¡å™¨é…ç½®ä½œä¸ºé»˜è®¤å€¼
    </div>
  </div>

  <h2>ğŸ§ª æµ‹è¯•åœºæ™¯3: ç™»å½•å‰åæ•°æ®è¿ç§»</h2>

  <div class="test-step">
    <h3>æ­¥éª¤1: æœªç™»å½•æ—¶ä¿®æ”¹è®¾ç½®</h3>
    <div class="log">
      <strong>æ“ä½œï¼š</strong><br>
      1. ä¸ç™»å½•è¿›å…¥è®¾ç½®é¡µé¢<br>
      2. ä¿®æ”¹è®¾ç½®å¹¶ä¿å­˜<br>
      3. è§‚å¯ŸlocalStorageä¸­çš„keyä¸º <code>anonymous_xxx</code>
    </div>
  </div>

  <div class="test-step">
    <h3>æ­¥éª¤2: ç™»å½•åæ•°æ®è¿ç§»</h3>
    <div class="log">
      <strong>æ“ä½œï¼š</strong><br>
      1. åœ¨åŒä¸€æµè§ˆå™¨ä¸­ç™»å½•ç”¨æˆ·<br>
      2. è¿›å…¥è®¾ç½®é¡µé¢<br>
      3. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—å’ŒlocalStorage<br>
      <br>
      <strong>é¢„æœŸç»“æœï¼š</strong><br>
      âœ“ ä½¿ç”¨æœåŠ¡å™¨é…ç½®ï¼ˆapp_configï¼‰ä½œä¸ºé»˜è®¤å€¼<br>
      âœ“ ç™»å½•ålocalStorage keyå˜ä¸º <code>user_{userId}</code><br>
      âœ“ å·²ç™»å½•ç”¨æˆ·çš„è®¾ç½®ä¼˜å…ˆçº§é«˜äºæœªç™»å½•æ—¶çš„è®¾ç½®
    </div>
  </div>

  <h2>ğŸ“Š æ•°æ®ç±»å‹éš”ç¦»éªŒè¯</h2>

  <div class="test-step">
    <h3>éœ€è¦éªŒè¯çš„æ•°æ®ç±»å‹</h3>
    <div class="log">
      <strong>1. quiz-settingsï¼ˆç­”é¢˜è®¾ç½®ï¼‰</strong><br>
      â€¢ Keyæ ¼å¼: <code>quiz-settings_user_{userId}</code><br>
      â€¢ æ•°æ®: { questionType, answerType, selectionStrategy, collectionId, tts }<br>
      <br>
      <strong>2. quiz-statsï¼ˆç­”é¢˜ç»Ÿè®¡ï¼‰</strong><br>
      â€¢ Keyæ ¼å¼: <code>quiz-stats_user_{userId}</code><br>
      â€¢ æ•°æ®: { totalGames, totalCorrect, bestScore, averageScore, lastPlayed }<br>
      <br>
      <strong>3. learning-progressï¼ˆå­¦ä¹ è¿›åº¦ï¼‰</strong><br>
      â€¢ Keyæ ¼å¼: <code>learning-progress_user_{userId}</code><br>
      â€¢ æ•°æ®: { [collectionId]: { lastPosition, totalWords, lastUpdated } }
    </div>
  </div>

  <h2>âœ… å®Œæˆæ£€æŸ¥æ¸…å•</h2>
  <div class="log success">
    <input type="checkbox"> ç”¨æˆ·Aå’Œç”¨æˆ·Bçš„è®¾ç½®æ•°æ®å®Œå…¨éš”ç¦»<br>
    <input type="checkbox"> localStorage keyåŒ…å«ç”¨æˆ·IDå‰ç¼€ï¼ˆuser_{userId}ï¼‰<br>
    <input type="checkbox"> æœªç™»å½•ç”¨æˆ·ä½¿ç”¨è®¾å¤‡IDéš”ç¦»ï¼ˆanonymous_{deviceId}ï¼‰<br>
    <input type="checkbox"> æœªç™»å½•ç”¨æˆ·å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨é…ç½®ï¼ˆapp_configï¼‰ä½œä¸ºé»˜è®¤å€¼<br>
    <input type="checkbox"> æ¸¸æˆç»Ÿè®¡æ•°æ®æ˜¾ç¤ºéš”ç¦»ï¼ˆæ¯ä¸ªç”¨æˆ·è‡ªå·±çš„ç»Ÿè®¡ï¼‰<br>
    <input type="checkbox"> å­¦ä¹ è¿›åº¦æ•°æ®éš”ç¦»ï¼ˆæ¯ä¸ªç”¨æˆ·è‡ªå·±çš„è¿›åº¦ï¼‰<br>
    <input type="checkbox"> ç™»å½•åæ•°æ®ä¸ä¼šæ··æ·†æœªç™»å½•æ—¶çš„æ•°æ®<br>
    <input type="checkbox"> æ§åˆ¶å°æ˜¾ç¤ºæ­£ç¡®çš„å­˜å‚¨key<br>
    <input type="checkbox"> æœªç™»å½•ç”¨æˆ·ä¸ä¼šåŒæ­¥åˆ°åç«¯ï¼ˆè·³è¿‡åŒæ­¥ï¼‰
  </div>

  <h2>ğŸ“š å…³é”®æŠ€æœ¯å®ç°</h2>

  <div class="log info">
    <strong>æ ¸å¿ƒå®ç°ï¼ˆuseLocalStorage.tsï¼‰ï¼š</strong><br>
    <div class="code-block">
// ç”ŸæˆlocalStorage keyï¼ŒåŒ…å«ç”¨æˆ·IDæˆ–åŒ¿åæ ‡è¯†
function getStorageKey(baseKey: string, userId?: string): string {
  const prefix = userId ? `user_${userId}` : `anonymous_${getDeviceId()}`;
  return `${baseKey}_${prefix}`;
}

// è·å–è®¾å¤‡å”¯ä¸€ID
function getDeviceId(): string {
  const KEY = 'device_id';
  let deviceId = localStorage.getItem(KEY);

  if (!deviceId) {
    deviceId = `device_${Date.now()}_${Math.random().toString(36).slice(2, 11)}`;
    localStorage.setItem(KEY, deviceId);
  }

  return deviceId;
}

// ä½¿ç”¨userIdå‚æ•°
export function useLocalStorage&lt;T&gt;(key: string, initialValue: T, userId?: string) {
  const storageKey = getStorageKey(key, userId);
  // ...
}
    </div>
  </div>

  <div class="log info">
    <strong>Hookæ›´æ–°ï¼ˆuseQuizSettingsç­‰ï¼‰ï¼š</strong><br>
    <div class="code-block">
export function useQuizSettings() {
  const { user } = useAuth();
  const userId = user?.id;

  const [settings, setSettings] = useLocalStorage&lt;Partial&lt;QuizSettings&gt;&gt;(
    'quiz-settings',
    defaultSettings,
    userId  // ä¼ é€’userId
  );
  // ...
}
    </div>
  </div>

</body>
</html>